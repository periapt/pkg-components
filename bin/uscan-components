#!/usr/bin/perl
use strict;
use warnings;
use Getopt::Long;
use Pod::Usage;
use Readonly;
use Cwd;

Readonly my $CWD => getcwd;
Readonly my %VALUED_ARGS=>(
    useragent=>1,
    timeout=>1,
    destdir=>1,
);

my $dry_run = 0;
my $help = 0;
my $man = 0;
my %args = (
    'dry-run'   => \$dry_run,
    'help'      => \$help,
    'man'       => \$man,
);

GetOptions(\%args,
    'dry-run!',
    'help|?',
    'man',
    'report!',
    'report-status!',
    'destdir=s',
    'timeout=i',
    'pasv!',
    'symlink!',
    'pasv!',
    'verbose!',
    'repack',
    'rename',
    'debug',
    'useragent|user-agent=s',
) or pod2usage(2);
pod2usage(1) if $help;
pod2usage(-exitstatus => 0, -verbose=>2) if $man;

delete $args{help};
delete $args{man};
delete $args{'dry-run'};

my $usage = "uscan ";
foreach my $arg (keys %args) {
    if ($VALUED_ARGS{$arg}) {
        $usage .= "--$arg=$args{$arg} ";
    }
    elsif ($args{$arg}) {
        $usage .= "--$arg ";
    }
    else {
        $usage .= "--no-$arg ";
    }
}
        

if ($dry_run) {
    print "This is a dry-run: $usage\n";
}
else {
    print "This is for real:  $usage\n";
}

exit(0);

=head1 NAME

uscan-components - wrapper around uscan for package and components

=head1 SYNOPSIS

B<uscan-components> [S<I<options>>]

=head1 DESCRIPTION

C<uscan-components> is a wrapper around C<uscan> for packages using
C<dh_components>. Firstly it will check that both the package and all
the components have watch files; and will return an error if they do not.
Then it will run uscan on the main watch file. If that downloads something
it will run uscan on each of the components. It accepts a number of 
uscan options all of which are passed onto to each invocation of uscan.

=head1 OPTIONS

=over 4

=item B<--dry-run>

If set no actual uscan will not actually be called but those that might be
will be listed.

=item B<--help>

Prints a brief help message and exits.

=item B<--man>

Prints the manual page and exits.

=item B<--report>

=item B<--report-status>

=item B<--destdir>

=item B<--pasv>

=item B<--no-pasv>

=item B<--timeout>

=item B<--symlink>

=item B<--no-symlink>

=item B<--verbose>

=item B<--no-verbose>

=item B<--rename>

=item B<--repack>

=item B<--debug>

=item B<--user-agent>, B<--useragent>

All of the these arguments are passed straight to each uscan invocation.

=back

=head1 SEE ALSO

L<uscan(1)>

=head1 AUTHOR

Nicholas Bamber <nicholas@periapt.co.uk>

=cut
